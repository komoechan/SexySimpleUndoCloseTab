const languageTexts = {
    zh: {
        title: 'Êâ©Â±ïËÆæÁΩÆ',
        themeLabel: '‰∏ªÈ¢ò:',
        themeSystem: 'Ë∑üÈöèÁ≥ªÁªü',
        themeLight: 'ÊµÖËâ≤',
        themeDark: 'Ê∑±Ëâ≤',
        languageLabel: 'üåêËØ≠Ë®Ä:',
        maxRecentLabel: 'ÊúÄÂ§ßËÆ∞ÂΩïÊï∞:',
        maxRecentHelp: 'ËÆæÁΩÆÊúÄËøëÂÖ≥Èó≠Ê†áÁ≠æÈ°µÁöÑÊúÄÂ§ßËÆ∞ÂΩïÊï∞Èáè (1-20000)',
        popupWidthLabel: 'ÂºπÁ™óÂÆΩÂ∫¶:',
        popupWidthHelp: 'ËÆæÁΩÆÂºπÂá∫Á™óÂè£ÁöÑÂÆΩÂ∫¶ (300-800ÂÉèÁ¥†)',
        showTabCountLabel: 'ÊòæÁ§∫Ê†áÁ≠æÈ°µÊï∞Èáè:',
        showUrlLabel: 'ÊòæÁ§∫ÂØπÂ∫îURL:',
        clearModeLabel: 'Ê†áÁ≠æÈ°µÊ∏ÖÁêÜÊ®°Âºè:',
        clearModeNone: '‰∏çÂ§ÑÁêÜ',
        clearModeIncognito: '‰ªÖÊ∏ÖÁ©∫Êó†ÁóïÊµèËßàÊ†áÁ≠æÈ°µ',
        clearModeAll: 'Ê∏ÖÁ©∫ÊâÄÊúâÊ†áÁ≠æÈ°µ',
        clearModeHelp: 'ÈÄâÊã©ÂΩìÂÖ≥Èó≠Êó†ÁóïÁ™óÂè£ÊàñÈÄÄÂá∫ÊµèËßàÂô®Êó∂ÁöÑÂ§ÑÁêÜÊñπÂºè',
        navigationPositionLabel: 'ÂØºËà™‰ΩçÁΩÆ:',
        pageModeLabel: 'ÁøªÈ°µÊ®°Âºè:',
        navigationPositionTop: 'È°∂ÈÉ®',
        navigationPositionBottom: 'Â∫ïÈÉ®',
        pageModePagination: 'ÂàÜÈ°µÊåâÈíÆ',
        pageModeInfinite: 'ÁÄëÂ∏ÉÊµÅ',
        dataManagementLabel: 'Êï∞ÊçÆÁÆ°ÁêÜ:',
        clearClosedTabsBtn: 'Ê∏ÖÈô§ÊâÄÊúâÂÖ≥Èó≠Ê†áÁ≠æÈ°µ',
        clearClosedTabsHelp: 'Ê≠§Êìç‰ΩúÂ∞ÜÂà†Èô§ÊâÄÊúâ‰øùÂ≠òÁöÑÂÖ≥Èó≠Ê†áÁ≠æÈ°µËÆ∞ÂΩïÔºå‰∏çÂΩ±ÂìçÊµèËßàÂô®ÂéÜÂè≤ËÆ∞ÂΩï„ÄÇ',
        confirmDeleteTitle: 'Á°ÆËÆ§Âà†Èô§',
        confirmDeleteMessage: 'ÊÇ®Á°ÆÂÆöË¶ÅÂà†Èô§ÊâÄÊúâÂ∑≤‰øùÂ≠òÁöÑÂÖ≥Èó≠Ê†áÁ≠æÈ°µÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ',
        tabCountText: 'ÂΩìÂâç‰øùÂ≠òÁöÑÊ†áÁ≠æÈ°µÊï∞Èáè:',
        cancelBtn: 'ÂèñÊ∂à',
        confirmBtn: 'Á°ÆËÆ§Âà†Èô§',
        deleteSuccess: 'Â∑≤ÊàêÂäüÂà†Èô§ÊâÄÊúâÂÖ≥Èó≠Ê†áÁ≠æÈ°µËÆ∞ÂΩï',
        shortcutLabel: 'Âø´Êç∑ÈîÆ: ÊâìÂºÄÊúÄËøëÂÖ≥Èó≠ÁöÑÊ†áÁ≠æÈ°µ',
        shortcutHelp: 'ÈªòËÆ§Âø´Êç∑ÈîÆÔºöWindows/Linux ‰∏∫ Ctrl+Shift+ZÔºåMac ‰∏∫ Cmd+Shift+Z„ÄÇÊÇ®ÂèØ‰ª•ÁÇπÂáª‰∏ãÊñπÊåâÈíÆËøõÂÖ•ÊµèËßàÂô®ÁöÑÊâ©Â±ïÂø´Êç∑ÈîÆËÆæÁΩÆÈ°µÈù¢ËøõË°å‰øÆÊîπ„ÄÇ',
        shortcutSupportNote: 'ËØ∑Ê≥®ÊÑèËØ•ÂäüËÉΩ‰∏ç‰∏ÄÂÆöÊîØÊåÅÊâÄÊúâÁöÑÊµèËßàÂô®„ÄÇ',
        openShortcutSettingsBtn: 'ÊâìÂºÄÊµèËßàÂô®Âø´Êç∑ÈîÆËÆæÁΩÆ',
        resetShortcutBtn: 'ÈáçÁΩÆ‰∏∫ÈªòËÆ§',
        shortcutResetInfo: 'ËØ∑Âú®ÊâìÂºÄÁöÑ‚ÄúÊâ©Â±ïÂø´Êç∑ÈîÆ‚ÄùÈ°µÈù¢‰∏≠Â∞ÜÂëΩ‰ª§ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÔºåÊàñÊâãÂä®ËÆæÁΩÆ‰∏∫ÊÇ®ÂñúÊ¨¢ÁöÑÊåâÈîÆÁªÑÂêà„ÄÇ'
    },
    en: {
        title: 'Extension Options',
        themeLabel: 'Theme:',
        themeSystem: 'System',
        themeLight: 'Light',
        themeDark: 'Dark',
        languageLabel: 'üåêLanguage:',
        maxRecentLabel: 'Max Recent Items:',
        maxRecentHelp: 'Set the maximum number of recently closed tabs (1-20000)',
        popupWidthLabel: 'Popup Width:',
        popupWidthHelp: 'Set the width of the popup window (300-800 pixels)',
        showTabCountLabel: 'Show Tab Count:',
        showUrlLabel: 'Show URL:',
        clearModeLabel: 'Tab Clear Mode:',
        clearModeNone: 'Do Nothing',
        clearModeIncognito: 'Clear Incognito Tabs Only',
        clearModeAll: 'Clear All Tabs',
        clearModeHelp: 'Choose how to handle tabs when closing incognito windows or exiting browser',
        navigationPositionLabel: 'Navigation Position:',
        pageModeLabel: 'Page Mode:',
        navigationPositionTop: 'Top',
        navigationPositionBottom: 'Bottom',
        pageModePagination: 'Pagination',
        pageModeInfinite: 'Infinite',
        dataManagementLabel: 'Data Management:',
        clearClosedTabsBtn: 'Clear All Closed Tabs',
        clearClosedTabsHelp: 'This will delete all saved closed tab records without affecting browser history.',
        confirmDeleteTitle: 'Confirm Delete',
        confirmDeleteMessage: 'Are you sure you want to delete all saved closed tabs? This action cannot be undone.',
        tabCountText: 'Current saved tabs count:',
        cancelBtn: 'Cancel',
        confirmBtn: 'Confirm Delete',
        deleteSuccess: 'Successfully deleted all closed tab records',
        shortcutLabel: 'Shortcut: Open Most Recently Closed Tab',
        shortcutHelp: 'Default: Ctrl+Shift+Z on Windows/Linux, Cmd+Shift+Z on Mac. Click below to open the browser‚Äôs extension shortcut settings to change it.',
        shortcutSupportNote: 'Please note that this feature may not support all browsers.',
        openShortcutSettingsBtn: 'Open Browser Shortcut Settings',
        resetShortcutBtn: 'Reset to Default',
        shortcutResetInfo: 'Use the ‚ÄúExtension Shortcuts‚Äù page to reset to default or set your preferred key combination.'
    },
    ja: {
        title: 'Êã°ÂºµÊ©üËÉΩ„ÅÆË®≠ÂÆö',
        themeLabel: '„ÉÜ„Éº„Éû:',
        themeSystem: '„Ç∑„Çπ„ÉÜ„É†',
        themeLight: '„É©„Ç§„Éà',
        themeDark: '„ÉÄ„Éº„ÇØ',
        languageLabel: 'üåêË®ÄË™û:',
        maxRecentLabel: 'ÊúÄÂ§ßÂ±•Ê≠¥Êï∞:',
        maxRecentHelp: 'ÊúÄËøëÈñâ„Åò„Åü„Çø„Éñ„ÅÆÊúÄÂ§ßÂ±•Ê≠¥Êï∞„ÇíË®≠ÂÆö (1-20000)',
        popupWidthLabel: '„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆÂπÖ:',
        popupWidthHelp: '„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÆÂπÖ„ÇíË®≠ÂÆö (300-800„Éî„ÇØ„Çª„É´)',
        showTabCountLabel: '„Çø„ÉñÊï∞„ÇíË°®Á§∫:',
        showUrlLabel: 'URL „ÇíË°®Á§∫:',
        clearModeLabel: '„Çø„Éñ„ÇØ„É™„Ç¢„É¢„Éº„Éâ:',
        clearModeNone: '‰Ωï„ÇÇ„Åó„Å™„ÅÑ',
        clearModeIncognito: '„Éó„É©„Ç§„Éô„Éº„Éà„Çø„Éñ„ÅÆ„Åø„ÇØ„É™„Ç¢',
        clearModeAll: '„Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Çí„ÇØ„É™„Ç¢',
        clearModeHelp: '„Éó„É©„Ç§„Éô„Éº„Éà„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÈñâ„Åò„Çã„Åã„Éñ„É©„Ç¶„Ç∂„ÇíÁµÇ‰∫Ü„Åô„ÇãÈöõ„ÅÆÂá¶ÁêÜÊñπÊ≥ï„ÇíÈÅ∏Êäû',
        navigationPositionLabel: '„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥‰ΩçÁΩÆ:',
        pageModeLabel: '„Éö„Éº„Ç∏„É¢„Éº„Éâ:',
        navigationPositionTop: '‰∏äÈÉ®',
        navigationPositionBottom: '‰∏ãÈÉ®',
        pageModePagination: '„Éö„Éº„Ç∏„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥',
        pageModeInfinite: '„Ç§„É≥„Éï„Ç£„Éã„ÉÜ„Ç£„Çπ„ÇØ„É≠„Éº„É´',
        dataManagementLabel: '„Éá„Éº„ÇøÁÆ°ÁêÜ:',
        clearClosedTabsBtn: 'Èñâ„Åò„Åü„Çø„Éñ„ÇíÂÖ®„Å¶ÂâäÈô§',
        clearClosedTabsHelp: '„Åì„ÅÆÊìç‰Ωú„Å´„Çà„Çä„ÄÅ‰øùÂ≠ò„Åï„Çå„ÅüÈñâ„Åò„Åü„Çø„Éñ„ÅÆË®òÈå≤„Åå„Åô„Åπ„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆÂ±•Ê≠¥„Å´„ÅØÂΩ±Èüø„Åó„Åæ„Åõ„Çì„ÄÇ',
        confirmDeleteTitle: 'ÂâäÈô§„ÅÆÁ¢∫Ë™ç',
        confirmDeleteMessage: '‰øùÂ≠ò„Åï„Çå„Åü„Åô„Åπ„Å¶„ÅÆÈñâ„Åò„Åü„Çø„Éñ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ',
        tabCountText: 'ÁèæÂú®‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Çø„ÉñÊï∞:',
        cancelBtn: '„Ç≠„É£„É≥„Çª„É´',
        confirmBtn: 'ÂâäÈô§Á¢∫Ë™ç',
        deleteSuccess: 'Èñâ„Åò„Åü„Çø„Éñ„ÅÆË®òÈå≤„ÇíÊ≠£Â∏∏„Å´ÂâäÈô§„Åó„Åæ„Åó„Åü',
        shortcutLabel: '„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà: ÊúÄËøëÈñâ„Åò„Åü„Çø„Éñ„ÇíÈñã„Åè',
        shortcutHelp: 'Êó¢ÂÆö: Windows/Linux „ÅØ Ctrl+Shift+Z„ÄÅMac „ÅØ Cmd+Shift+Z„ÄÇ‰∏ã„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éñ„É©„Ç¶„Ç∂„ÅÆÊã°ÂºµÊ©üËÉΩ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„Éö„Éº„Ç∏„ÇíÈñã„Åç„ÄÅÂ§âÊõ¥„Åß„Åç„Åæ„Åô„ÄÇ',
        shortcutSupportNote: '„Åì„ÅÆÊ©üËÉΩ„ÅØ„Åô„Åπ„Å¶„ÅÆ„Éñ„É©„Ç¶„Ç∂„Åß„Çµ„Éù„Éº„Éà„Åï„Çå„Å™„ÅÑÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ',
        openShortcutSettingsBtn: '„Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàË®≠ÂÆö„ÇíÈñã„Åè',
        resetShortcutBtn: '„Éá„Éï„Ç©„É´„Éà„Å´„É™„Çª„ÉÉ„Éà',
        shortcutResetInfo: '„ÄåÊã°ÂºµÊ©üËÉΩ„ÅÆ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Äç„Éö„Éº„Ç∏„Åß„Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô„Åã„ÄÅ„ÅäÂ•Ω„Åø„ÅÆ„Ç≠„Éº„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
    },
    ko: {
        title: 'ÌôïÏû• ÏÑ§Ï†ï',
        themeLabel: 'ÌÖåÎßà:',
        themeSystem: 'ÏãúÏä§ÌÖú',
        themeLight: 'ÎùºÏù¥Ìä∏',
        themeDark: 'Îã§ÌÅ¨',
        languageLabel: 'üåêÏñ∏Ïñ¥:',
        maxRecentLabel: 'ÏµúÎåÄ ÏµúÍ∑º Ìï≠Î™©:',
        maxRecentHelp: 'ÏµúÍ∑º Îã´ÏùÄ ÌÉ≠Ïùò ÏµúÎåÄ Ìï≠Î™© Ïàò ÏÑ§Ï†ï (1-20000)',
        popupWidthLabel: 'ÌåùÏóÖ ÎÑàÎπÑ:',
        popupWidthHelp: 'ÌåùÏóÖ Ï∞ΩÏùò ÎÑàÎπÑ ÏÑ§Ï†ï (300-800ÌîΩÏÖÄ)',
        showTabCountLabel: 'ÌÉ≠ Ïàò ÌëúÏãú:',
        showUrlLabel: 'URL ÌëúÏãú:',
        clearModeLabel: 'ÌÉ≠ Ï†ïÎ¶¨ Î™®Îìú:',
        clearModeNone: 'ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå',
        clearModeIncognito: 'ÏãúÌÅ¨Î¶ø ÌÉ≠Îßå Ï†ïÎ¶¨',
        clearModeAll: 'Î™®Îì† ÌÉ≠ Ï†ïÎ¶¨',
        clearModeHelp: 'ÏãúÌÅ¨Î¶ø Ï∞ΩÏùÑ Îã´Í±∞ÎÇò Î∏åÎùºÏö∞Ï†ÄÎ•º Ï¢ÖÎ£åÌï† ÎïåÏùò Ï≤òÎ¶¨ Î∞©Î≤ïÏùÑ ÏÑ†ÌÉù',
        navigationPositionLabel: 'ÌÉêÏÉâ ÏúÑÏπò:',
        pageModeLabel: 'ÌéòÏù¥ÏßÄ Î™®Îìú:',
        navigationPositionTop: 'ÏÉÅÎã®',
        navigationPositionBottom: 'ÌïòÎã®',
        pageModePagination: 'ÌéòÏù¥ÏßÄ ÌÉêÏÉâ',
        pageModeInfinite: 'Î¨¥Ìïú Ïä§ÌÅ¨Î°§',
        dataManagementLabel: 'Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨:',
        clearClosedTabsBtn: 'Î™®Îì† Îã´Ìûå ÌÉ≠ ÏÇ≠Ï†ú',
        clearClosedTabsHelp: 'Ï†ÄÏû•Îêú Î™®Îì† Îã´Ìûå ÌÉ≠ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä Í∏∞Î°ùÏóêÎäî ÏòÅÌñ•ÏùÑ Ï£ºÏßÄ ÏïäÏäµÎãàÎã§.',
        confirmDeleteTitle: 'ÏÇ≠Ï†ú ÌôïÏù∏',
        confirmDeleteMessage: 'Ï†ÄÏû•Îêú Î™®Îì† Îã´Ìûå ÌÉ≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.',
        tabCountText: 'ÌòÑÏû¨ Ï†ÄÏû•Îêú ÌÉ≠ Ïàò:',
        cancelBtn: 'Ï∑®ÏÜå',
        confirmBtn: 'ÏÇ≠Ï†ú ÌôïÏù∏',
        deleteSuccess: 'Îã´Ìûå ÌÉ≠ Í∏∞Î°ùÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§',
        shortcutLabel: 'Îã®Ï∂ïÌÇ§: Í∞ÄÏû• ÏµúÍ∑ºÏóê Îã´ÏùÄ ÌÉ≠ Ïó¥Í∏∞',
        shortcutHelp: 'Í∏∞Î≥∏Í∞í: Windows/LinuxÎäî Ctrl+Shift+Z, MacÏùÄ Cmd+Shift+Z. ÏïÑÎûò Î≤ÑÌäºÏùÑ ÎàåÎü¨ Î∏åÎùºÏö∞Ï†Ä ÌôïÏû• Îã®Ï∂ïÌÇ§ ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏó¨ Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî.',
        shortcutSupportNote: 'Ïù¥ Í∏∞Îä•ÏùÄ Î™®Îì† Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÄÏõêÎêòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏäµÎãàÎã§.',
        openShortcutSettingsBtn: 'Î∏åÎùºÏö∞Ï†Ä Îã®Ï∂ïÌÇ§ ÏÑ§Ï†ï Ïó¥Í∏∞',
        resetShortcutBtn: 'Í∏∞Î≥∏Í∞íÏúºÎ°ú Ïû¨ÏÑ§Ï†ï',
        shortcutResetInfo: '‚ÄúÌôïÏû• ÌîÑÎ°úÍ∑∏Îû® Îã®Ï∂ïÌÇ§‚Äù ÌéòÏù¥ÏßÄÏóêÏÑú Í∏∞Î≥∏Í∞íÏúºÎ°ú Ïû¨ÏÑ§Ï†ïÌïòÍ±∞ÎÇò ÏõêÌïòÎäî ÌÇ§ Ï°∞Ìï©ÏúºÎ°ú ÏÑ§Ï†ïÌïòÏÑ∏Ïöî.'
    },
    fr: {
        title: 'Options de l\'extension',
        themeLabel: 'Th√®me:',
        themeSystem: 'Syst√®me',
        themeLight: 'Clair',
        themeDark: 'Sombre',
        languageLabel: 'üåêLangue:',
        maxRecentLabel: 'Articles r√©cents max:',
        maxRecentHelp: 'D√©finir le nombre maximum d\'onglets r√©cemment ferm√©s (1-20000)',
        popupWidthLabel: 'Largeur de la fen√™tre:',
        popupWidthHelp: 'D√©finir la largeur de la fen√™tre contextuelle (300-800 pixels)',
        showTabCountLabel: 'Afficher le nombre d\'onglets:',
        showUrlLabel: 'Afficher l\'URL:',
        clearModeLabel: 'Mode de nettoyage des onglets:',
        clearModeNone: 'Ne rien faire',
        clearModeIncognito: 'Effacer les onglets priv√©s uniquement',
        clearModeAll: 'Effacer tous les onglets',
        clearModeHelp: 'Choisir comment g√©rer les onglets lors de la fermeture des fen√™tres priv√©es ou de la sortie du navigateur',
        navigationPositionLabel: 'Position de navigation:',
        pageModeLabel: 'Mode de pagination:',
        navigationPositionTop: 'Haut',
        navigationPositionBottom: 'Bas',
        pageModePagination: 'Pagination',
        pageModeInfinite: 'Infini',
        dataManagementLabel: 'Gestion des donn√©es:',
        clearClosedTabsBtn: 'Supprimer tous les onglets ferm√©s',
        clearClosedTabsHelp: 'Cette op√©ration supprimera tous les enregistrements d\'onglets ferm√©s sauvegard√©s sans affecter l\'historique du navigateur.',
        confirmDeleteTitle: 'Confirmer la suppression',
        confirmDeleteMessage: '√ätes-vous s√ªr de vouloir supprimer tous les onglets ferm√©s sauvegard√©s ? Cette action ne peut pas √™tre annul√©e.',
        tabCountText: 'Nombre d\'onglets actuellement sauvegard√©s:',
        cancelBtn: 'Annuler',
        confirmBtn: 'Confirmer la suppression',
        deleteSuccess: 'Tous les enregistrements d\'onglets ferm√©s ont √©t√© supprim√©s avec succ√®s',
        shortcutLabel: 'Raccourci : Ouvrir le dernier onglet ferm√©',
        shortcutHelp: 'Par d√©faut : Ctrl+Maj+Z sur Windows/Linux, Cmd+Maj+Z sur Mac. Cliquez ci-dessous pour ouvrir la page des raccourcis des extensions du navigateur afin de le modifier.',
        shortcutSupportNote: 'Veuillez noter que cette fonctionnalit√© peut ne pas √™tre prise en charge par tous les navigateurs.',
        openShortcutSettingsBtn: 'Ouvrir les raccourcis du navigateur',
        resetShortcutBtn: 'R√©initialiser par d√©faut',
        shortcutResetInfo: 'Utilisez la page ¬´ Raccourcis des extensions ¬ª pour r√©initialiser par d√©faut ou d√©finir votre combinaison pr√©f√©r√©e.'
    },
    de: {
        title: 'Erweiterungsoptionen',
        themeLabel: 'Thema:',
        themeSystem: 'System',
        themeLight: 'Hell',
        themeDark: 'Dunkel',
        languageLabel: 'üåêSprache:',
        maxRecentLabel: 'Maximale k√ºrzliche Elemente:',
        maxRecentHelp: 'Maximale Anzahl k√ºrzlich geschlossener Tabs festlegen (1-20000)',
        popupWidthLabel: 'Popup-Breite:',
        popupWidthHelp: 'Breite des Popup-Fensters festlegen (300-800 Pixel)',
        showTabCountLabel: 'Tab-Anzahl anzeigen:',
        showUrlLabel: 'URL anzeigen:',
        clearModeLabel: 'Tab-L√∂schmodus:',
        clearModeNone: 'Nichts tun',
        clearModeIncognito: 'Nur Inkognito-Tabs l√∂schen',
        clearModeAll: 'Alle Tabs l√∂schen',
        clearModeHelp: 'W√§hlen Sie, wie Tabs beim Schlie√üen von Inkognito-Fenstern oder Beenden des Browsers behandelt werden',
        navigationPositionLabel: 'Navigation Position:',
        pageModeLabel: 'Seitenmodus:',
        navigationPositionTop: 'Oben',
        navigationPositionBottom: 'Unten',
        pageModePagination: 'Seitennavigation',
        pageModeInfinite: 'Unendliche Scrollung',
        dataManagementLabel: 'Datenverwaltung:',
        clearClosedTabsBtn: 'Alle geschlossenen Tabs l√∂schen',
        clearClosedTabsHelp: 'Diese Aktion l√∂scht alle gespeicherten Aufzeichnungen geschlossener Tabs, ohne den Browser-Verlauf zu beeintr√§chtigen.',
        confirmDeleteTitle: 'L√∂schen best√§tigen',
        confirmDeleteMessage: 'Sind Sie sicher, dass Sie alle gespeicherten geschlossenen Tabs l√∂schen m√∂chten? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.',
        tabCountText: 'Anzahl aktuell gespeicherter Tabs:',
        cancelBtn: 'Abbrechen',
        confirmBtn: 'L√∂schen best√§tigen',
        deleteSuccess: 'Alle Aufzeichnungen geschlossener Tabs wurden erfolgreich gel√∂scht',
        shortcutLabel: 'Tastenk√ºrzel: Zuletzt geschlossenen Tab √∂ffnen',
        shortcutHelp: 'Standard: Strg+Umschalt+Z unter Windows/Linux, Cmd+Umschalt+Z auf dem Mac. Klicken Sie unten, um die Browserseite f√ºr Erweiterungs-Tastenk√ºrzel zu √∂ffnen und dies zu √§ndern.',
        shortcutSupportNote: 'Bitte beachten Sie, dass diese Funktion m√∂glicherweise nicht von allen Browsern unterst√ºtzt wird.',
        openShortcutSettingsBtn: 'Browser-Tastenk√ºrzel √∂ffnen',
        resetShortcutBtn: 'Auf Standard zur√ºcksetzen',
        shortcutResetInfo: 'Verwenden Sie die Seite ‚ÄûErweiterungs-Tastenk√ºrzel‚Äú, um auf Standard zur√ºckzusetzen oder Ihre bevorzugte Tastenfolge festzulegen.'
    },
    es: {
        title: 'Opciones de la extensi√≥n',
        themeLabel: 'Tema:',
        themeSystem: 'Sistema',
        themeLight: 'Claro',
        themeDark: 'Oscuro',
        languageLabel: 'üåêIdioma:',
        maxRecentLabel: 'Elementos recientes m√°ximos:',
        maxRecentHelp: 'Establecer el n√∫mero m√°ximo de pesta√±as cerradas recientemente (1-20000)',
        popupWidthLabel: 'Ancho de la ventana emergente:',
        popupWidthHelp: 'Establecer el ancho de la ventana emergente (300-800 p√≠xeles)',
        showTabCountLabel: 'Mostrar n√∫mero de pesta√±as:',
        showUrlLabel: 'Mostrar URL:',
        clearModeLabel: 'Modo de limpieza de pesta√±as:',
        clearModeNone: 'No hacer nada',
        clearModeIncognito: 'Limpiar solo pesta√±as de inc√≥gnito',
        clearModeAll: 'Limpiar todas las pesta√±as',
        clearModeHelp: 'Elegir c√≥mo manejar las pesta√±as al cerrar ventanas de inc√≥gnito o salir del navegador',
        navigationPositionLabel: 'Posici√≥n de navegaci√≥n:',
        pageModeLabel: 'Modo de paginaci√≥n:',
        navigationPositionTop: 'Arriba',
        navigationPositionBottom: 'Abajo',
        pageModePagination: 'Paginado',
        pageModeInfinite: 'Infinito',
        dataManagementLabel: 'Gesti√≥n de datos:',
        clearClosedTabsBtn: 'Eliminar todas las pesta√±as cerradas',
        clearClosedTabsHelp: 'Esta operaci√≥n eliminar√° todos los registros de pesta√±as cerradas guardados sin afectar el historial del navegador.',
        confirmDeleteTitle: 'Confirmar eliminaci√≥n',
        confirmDeleteMessage: '¬øEst√° seguro de que desea eliminar todas las pesta√±as cerradas guardadas? Esta acci√≥n no se puede deshacer.',
        tabCountText: 'N√∫mero de pesta√±as actualmente guardadas:',
        cancelBtn: 'Cancelar',
        confirmBtn: 'Confirmar eliminaci√≥n',
        deleteSuccess: 'Se eliminaron exitosamente todos los registros de pesta√±as cerradas',
        shortcutLabel: 'Atajo: Abrir la pesta√±a cerrada m√°s reciente',
        shortcutHelp: 'Por defecto: Ctrl+Shift+Z en Windows/Linux, Cmd+Shift+Z en Mac. Haga clic abajo para abrir la p√°gina de atajos de extensiones del navegador y cambiarlo.',
        shortcutSupportNote: 'Tenga en cuenta que esta funci√≥n puede no ser compatible con todos los navegadores.',
        openShortcutSettingsBtn: 'Abrir configuraci√≥n de atajos del navegador',
        resetShortcutBtn: 'Restablecer a predeterminado',
        shortcutResetInfo: 'Use la p√°gina ¬´Atajos de extensiones¬ª para restablecer a predeterminado o definir su combinaci√≥n preferida.'
    }
};

// Âú®ÈùûÊâ©Â±ïÈ¢ÑËßàÁéØÂ¢ÉÊèê‰æõËΩªÈáèÁ∫ß chrome API mockÔºåÈÅøÂÖçËÆøÈóÆÊä•Èîô
(() => {
    const needMock = typeof chrome === 'undefined' || !chrome.storage || !chrome.storage.sync;
    if (needMock) {
        const store = {};
        const storageSync = {
            async get(keys) {
                if (!keys) return { ...store };
                if (Array.isArray(keys)) {
                    const result = {};
                    keys.forEach(k => { result[k] = store[k]; });
                    return result;
                }
                if (typeof keys === 'string') {
                    return { [keys]: store[keys] };
                }
                if (typeof keys === 'object') {
                    const result = {};
                    Object.keys(keys).forEach(k => { result[k] = store[k] ?? keys[k]; });
                    return result;
                }
                return { ...store };
            },
            async set(obj) {
                Object.assign(store, obj);
            }
        };
        const storageOnChanged = { addListener() { /* noop in preview */ } };

        window.chrome = window.chrome || {};
        chrome.storage = chrome.storage || {};
        chrome.storage.sync = storageSync;
        chrome.storage.onChanged = storageOnChanged;
        chrome.tabs = chrome.tabs || { create({ url }) { console.log('[Preview] open tab:', url); } };
        chrome.commands = chrome.commands || { getAll(cb) { cb([]); } };
    }
})();

function updateLanguageTexts(language) {
    const texts = languageTexts[language];
    if (!texts) {
        console.error(`Language texts not found for language: ${language}`);
        return;
    }
    document.querySelector('h1').textContent = texts.title;
    document.querySelector('label[for="themeSelect"]').textContent = texts.themeLabel;
    document.querySelector('option[value="light"]').textContent = texts.themeLight;
    document.querySelector('option[value="dark"]').textContent = texts.themeDark;
    document.querySelector('label[for="languageSelect"]').textContent = texts.languageLabel;
    document.querySelector('label[for="maxRecent"]').textContent = texts.maxRecentLabel;
    const maxRecentHelpEl = document.getElementById('maxRecentHelpText') || document.querySelectorAll('.help-text')[0];
    if (maxRecentHelpEl) maxRecentHelpEl.textContent = texts.maxRecentHelp;
    document.querySelector('label[for="popupWidth"]').textContent = texts.popupWidthLabel;
    const popupWidthHelpEl = document.getElementById('popupWidthHelpText') || document.querySelectorAll('.help-text')[1];
    if (popupWidthHelpEl) popupWidthHelpEl.textContent = texts.popupWidthHelp;
    document.querySelector('label[for="showTabCount"]').textContent = texts.showTabCountLabel;
    const showUrlLabelEl = document.querySelector('label[for="showUrl"]');
    if (showUrlLabelEl) {
        showUrlLabelEl.textContent = texts.showUrlLabel;
    }
    document.querySelector('#clearModeLabel').textContent = texts.clearModeLabel;
    document.querySelector('#clearModeNoneLabel').textContent = texts.clearModeNone;
    document.querySelector('#clearModeIncognitoLabel').textContent = texts.clearModeIncognito;
    document.querySelector('#clearModeAllLabel').textContent = texts.clearModeAll;
    const clearModeHelpEl = document.getElementById('clearModeHelpText') || document.querySelectorAll('.help-text')[2];
    if (clearModeHelpEl) clearModeHelpEl.textContent = texts.clearModeHelp;
    document.querySelector('label[for="navigationPosition"]').textContent = texts.navigationPositionLabel;
    document.querySelector('option[value="top"]').textContent = texts.navigationPositionTop;
    document.querySelector('option[value="bottom"]').textContent = texts.navigationPositionBottom;
    document.querySelector('label[for="pageMode"]').textContent = texts.pageModeLabel;
    document.querySelector('option[value="pagination"]').textContent = texts.pageModePagination;
    document.querySelector('option[value="infinite"]').textContent = texts.pageModeInfinite;
    document.querySelector('#dataManagementLabel').textContent = texts.dataManagementLabel;
    document.querySelector('#clearClosedTabsBtn').textContent = texts.clearClosedTabsBtn;
    const dataManagementHelpEl = document.getElementById('dataManagementHelpText') || document.querySelectorAll('.help-text')[3];
    if (dataManagementHelpEl) dataManagementHelpEl.textContent = texts.clearClosedTabsHelp;

    // Âø´Êç∑ÈîÆÁõ∏ÂÖ≥ÊñáÊ°àÁªëÂÆöÔºàÂ≠òÂú®ÂàôÊõ¥Êñ∞Ôºâ
    const shortcutLabelEl = document.querySelector('label[for="shortcutOpenRecent"]');
    if (shortcutLabelEl && texts.shortcutLabel) shortcutLabelEl.textContent = texts.shortcutLabel;
    const shortcutHelpEl = document.getElementById('shortcutHelpText');
    if (shortcutHelpEl && texts.shortcutHelp) shortcutHelpEl.textContent = texts.shortcutHelp;
    const shortcutSupportNoteEl = document.getElementById('shortcutSupportNote');
    if (shortcutSupportNoteEl && texts.shortcutSupportNote) shortcutSupportNoteEl.textContent = texts.shortcutSupportNote;
    const openShortcutSettingsBtn = document.getElementById('openShortcutSettingsBtn');
    if (openShortcutSettingsBtn && texts.openShortcutSettingsBtn) openShortcutSettingsBtn.textContent = texts.openShortcutSettingsBtn;
    const resetShortcutBtn = document.getElementById('resetShortcutBtn');
    if (resetShortcutBtn && texts.resetShortcutBtn) resetShortcutBtn.textContent = texts.resetShortcutBtn;
    
    // Êõ¥Êñ∞Ê®°ÊÄÅÊ°ÜÊñáÊú¨
    document.getElementById('modalTitle').textContent = texts.confirmDeleteTitle;
    document.getElementById('modalMessage').textContent = texts.confirmDeleteMessage;
    document.getElementById('cancelBtn').textContent = texts.cancelBtn;
    document.getElementById('confirmBtn').textContent = texts.confirmBtn;

    // Êõ¥Êñ∞ÊúÄÂ§ßËÆ∞ÂΩïÊï∞ÁöÑÂçï‰ΩçÊòæÁ§∫
    const maxRecentValue = document.getElementById('maxRecent').value;
    const unitText = language === 'zh' ? 'Êù°' : '';
    document.getElementById('maxRecentTooltip').textContent = `${maxRecentValue}${unitText}`;

    // Êõ¥Êñ∞ÂºπÁ™óÂÆΩÂ∫¶ÁöÑÂçï‰ΩçÊòæÁ§∫
    const popupWidthValue = document.getElementById('popupWidth').value;
    const pixelText = language === 'zh' ? 'ÂÉèÁ¥†' : 'px';
    document.getElementById('popupWidthTooltip').textContent = `${popupWidthValue}${pixelText}`;
}

function applyTheme(theme) {
    if (theme === 'system') {
        const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
        document.documentElement.removeAttribute('data-force-theme');
    } else {
        document.documentElement.setAttribute('data-theme', theme);
        document.documentElement.setAttribute('data-force-theme', theme);
    }
}

document.addEventListener('DOMContentLoaded', async () => {
    const themeSelect = document.getElementById('themeSelect');
    const maxRecentInput = document.getElementById('maxRecent');
    const maxRecentSlider = document.getElementById('maxRecentSlider');
    const maxRecentTooltip = document.getElementById('maxRecentTooltip');
    const popupWidthInput = document.getElementById('popupWidth');
    const popupWidthSlider = document.getElementById('popupWidthSlider');
    const popupWidthTooltip = document.getElementById('popupWidthTooltip');
    const languageSelect = document.getElementById('languageSelect');
    const showTabCountCheckbox = document.getElementById('showTabCount');
    const showUrlCheckbox = document.getElementById('showUrl');
    const clearModeRadios = document.querySelectorAll('input[name="clearMode"]');
    const navigationPositionSelect = document.getElementById('navigationPosition');
    const pageModeSelect = document.getElementById('pageMode');
    
    // Ëé∑Âèñ‰øùÂ≠òÁöÑËÆæÁΩÆ
    const savedSettings = await chrome.storage.sync.get(['theme', 'maxRecent', 'popupWidth', 'language', 'showTabCount', 'showUrl', 'clearMode', 'navigationPosition', 'pageMode']);
    
    // ËÆæÁΩÆÈªòËÆ§ÂÄºÔºåÂè™ÊúâÂΩìÂ≠òÂÇ®‰∏≠Ê≤°ÊúâÂÄºÊó∂Êâç‰ΩøÁî®ÈªòËÆ§ÂÄº
    const savedTheme = savedSettings.theme !== undefined ? savedSettings.theme : 'system';
    const maxRecent = savedSettings.maxRecent !== undefined ? savedSettings.maxRecent : 100;
    const popupWidth = savedSettings.popupWidth !== undefined ? savedSettings.popupWidth : 500;
    const savedLanguage = savedSettings.language !== undefined ? savedSettings.language : 'zh';
    const showTabCount = savedSettings.showTabCount !== undefined ? savedSettings.showTabCount : true;
    const showUrl = savedSettings.showUrl !== undefined ? savedSettings.showUrl : true;
    const clearMode = savedSettings.clearMode !== undefined ? savedSettings.clearMode : 'none';
    const navigationPosition = savedSettings.navigationPosition !== undefined ? savedSettings.navigationPosition : 'top';
    const pageMode = savedSettings.pageMode !== undefined ? savedSettings.pageMode : 'pagination';
    
    // Á´ãÂç≥Â∫îÁî®‰∏ªÈ¢ò
    themeSelect.value = savedTheme;
    applyTheme(savedTheme);

    // ËÆæÁΩÆÊúÄÂ§ßËÆ∞ÂΩïÊï∞ÁöÑÂÄºÔºàËÄÉËôëÊªëÂùóÂíåËæìÂÖ•Ê°ÜÔºâ
    const maxRecentValue = Math.max(1, Math.min(20000, maxRecent));
    maxRecentInput.value = maxRecentValue;
    maxRecentSlider.value = maxRecentValue / 1000;
    updateSliderBackground(maxRecentSlider, maxRecentSlider.value);
    maxRecentTooltip.textContent = `${maxRecentValue}Êù°`;

    // ËÆæÁΩÆÂºπÁ™óÂÆΩÂ∫¶ÁöÑÂÄºÔºàËÄÉËôëÊªëÂùóÂíåËæìÂÖ•Ê°ÜÔºâ
    const popupWidthValue = Math.max(300, Math.min(800, popupWidth));
    popupWidthInput.value = popupWidthValue;
    popupWidthSlider.value = Math.round((popupWidthValue - 300) / 31.25);
    updateSliderBackground(popupWidthSlider, popupWidthSlider.value);
    popupWidthTooltip.textContent = `${popupWidthValue}px`;

    // ËÆæÁΩÆÂàùÂßãËØ≠Ë®ÄÊñáÊú¨
    languageSelect.value = savedLanguage;
    updateLanguageTexts(savedLanguage);

    // ËÆæÁΩÆÊòæÁ§∫Ê†áÁ≠æÈ°µÊï∞ÈáèÁöÑÂÄº
    showTabCountCheckbox.checked = showTabCount;

    // ËÆæÁΩÆÊòæÁ§∫URLÁöÑÂÄº
    if (showUrlCheckbox) {
        showUrlCheckbox.checked = showUrl;
    }

    // ËÆæÁΩÆÊ∏ÖÁêÜÊ®°ÂºèÁöÑÂÄº
    clearModeRadios.forEach(radio => {
        if (radio.value === clearMode) {
            radio.checked = true;
        }
    });

    // ËÆæÁΩÆÂØºËà™‰ΩçÁΩÆÂíåÈ°µÈù¢Ê®°ÂºèÁöÑÂÄº
    navigationPositionSelect.value = navigationPosition;
    pageModeSelect.value = pageMode;

    // Âø´Êç∑ÈîÆÊòæÁ§∫‰∏éÊìç‰Ωú
    const shortcutInput = document.getElementById('shortcutOpenRecent');
    const shortcutOpenBtn = document.getElementById('openShortcutSettingsBtn');
    const shortcutResetBtn = document.getElementById('resetShortcutBtn');
    const isChromeEnv = typeof chrome !== 'undefined' && !!chrome.commands;
    const defaultShortcut = /Mac/i.test(navigator.platform) ? 'Cmd+Shift+Z' : 'Ctrl+Shift+Z';

    if (shortcutInput) {
        shortcutInput.readOnly = true;
        shortcutInput.placeholder = defaultShortcut;
        if (isChromeEnv && chrome.commands && typeof chrome.commands.getAll === 'function') {
            chrome.commands.getAll((commands) => {
                try {
                    const cmd = commands && commands.find(c => c.name === 'open-most-recently-closed-tab');
                    if (cmd && cmd.shortcut) {
                        shortcutInput.value = cmd.shortcut;
                    } else {
                        shortcutInput.value = defaultShortcut;
                    }
                } catch (e) {
                    shortcutInput.value = defaultShortcut;
                }
            });
        } else {
            shortcutInput.value = defaultShortcut;
        }
    }

    if (shortcutOpenBtn) {
        shortcutOpenBtn.addEventListener('click', () => {
            if (isChromeEnv && chrome.tabs && typeof chrome.tabs.create === 'function') {
                chrome.tabs.create({ url: 'chrome://extensions/shortcuts' });
            } else {
                alert('ËØ∑Âú®ÊµèËßàÂô®Âú∞ÂùÄÊ†èËæìÂÖ• chrome://extensions/shortcuts ‰ª•ÊâìÂºÄÊâ©Â±ïÂø´Êç∑ÈîÆËÆæÁΩÆÈ°µÈù¢„ÄÇ');
            }
        });
    }

    if (shortcutResetBtn) {
        shortcutResetBtn.addEventListener('click', async () => {
            if (isChromeEnv && chrome.tabs && typeof chrome.tabs.create === 'function') {
                chrome.tabs.create({ url: 'chrome://extensions/shortcuts' });
            }
            // Ëé∑ÂèñÂΩìÂâçËØ≠Ë®Ä‰ª•ÊòæÁ§∫ÊèêÁ§∫
            let currentLanguage = 'zh';
            try {
                if (typeof chrome !== 'undefined' && chrome.storage && chrome.storage.sync && typeof chrome.storage.sync.get === 'function') {
                    const res = await chrome.storage.sync.get('language');
                    currentLanguage = res.language || 'zh';
                }
            } catch (e) {}
            const texts = languageTexts[currentLanguage] || languageTexts.zh;
            const msg = texts.shortcutResetInfo || 'Please use the browser extension shortcuts page to reset to default or set your preferred keys.';
            alert(msg);
        });
    }

    // Êõ¥Êñ∞ÊªëÂùóÊ∏êÂèòÊïàÊûúÁöÑÂáΩÊï∞
    function updateSliderBackground(slider, value) {
        const percentage = ((value - slider.min) / (slider.max - slider.min)) * 100;
        slider.style.setProperty('--slider-value', `${percentage}%`);
    }

    // ÂàùÂßãÂåñÊó∂Êõ¥Êñ∞ÊªëÂùóÊ∏êÂèò
    updateSliderBackground(maxRecentSlider, maxRecentValue / 1000);
    updateSliderBackground(popupWidthSlider, (popupWidthValue - 300) / 30);

    // ‰∏ªÈ¢òÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    themeSelect.addEventListener('change', async () => {
        const selectedTheme = themeSelect.value;
        await chrome.storage.sync.set({ theme: selectedTheme });
        applyTheme(selectedTheme);
    });

    // ÊúÄÂ§ßËÆ∞ÂΩïÊï∞ÊªëÂùóÂíåËæìÂÖ•Ê°ÜËÅîÂä®
    maxRecentSlider.addEventListener('input', async () => {
        const value = Math.round(maxRecentSlider.value * 1000);
        maxRecentInput.value = value;
        const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
        const unitText = currentLanguage === 'zh' ? 'Êù°' : '';
        maxRecentTooltip.textContent = `${value}${unitText}`;
        updateSliderBackground(maxRecentSlider, maxRecentSlider.value);
        await chrome.storage.sync.set({ maxRecent: value });
    });

    // Âª∂ËøüÈ™åËØÅÂíå‰øùÂ≠òÊúÄÂ§ßËÆ∞ÂΩïÊï∞
    let maxRecentTimeout;
    maxRecentInput.addEventListener('input', () => {
        clearTimeout(maxRecentTimeout);
        const value = parseInt(maxRecentInput.value, 10);
        if (!isNaN(value)) {
            if (value < 1 || value > 20000) {
                maxRecentInput.classList.add('error');
            } else {
                maxRecentInput.classList.remove('error');
            }
            maxRecentTimeout = setTimeout(async () => {
                const adjustedValue = Math.max(1, Math.min(20000, value));
                maxRecentInput.value = adjustedValue;
                maxRecentInput.classList.remove('error');
                maxRecentSlider.value = adjustedValue / 1000;
                const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
                const unitText = currentLanguage === 'zh' ? 'Êù°' : '';
                maxRecentTooltip.textContent = `${adjustedValue}${unitText}`;
                updateSliderBackground(maxRecentSlider, maxRecentSlider.value);
                await chrome.storage.sync.set({ maxRecent: adjustedValue });
            }, 1000);
        }
    });

    maxRecentInput.addEventListener('blur', async () => {
        clearTimeout(maxRecentTimeout);
        let value = parseInt(maxRecentInput.value, 10);
        if (isNaN(value) || value < 1) value = 1;
        if (value > 20000) value = 20000;
        maxRecentInput.value = value;
        maxRecentInput.classList.remove('error');
        maxRecentSlider.value = value / 1000;
        const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
        const unitText = currentLanguage === 'zh' ? 'Êù°' : '';
        maxRecentTooltip.textContent = `${value}${unitText}`;
        updateSliderBackground(maxRecentSlider, maxRecentSlider.value);
        await chrome.storage.sync.set({ maxRecent: value });
    });

    // ÂºπÁ™óÂÆΩÂ∫¶ÊªëÂùóÂíåËæìÂÖ•Ê°ÜËÅîÂä®
    popupWidthSlider.addEventListener('input', async () => {
        const value = Math.round(300 + popupWidthSlider.value * 31.25);
        popupWidthInput.value = value;
        const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
        const pixelText = currentLanguage === 'zh' ? 'ÂÉèÁ¥†' : 'px';
        popupWidthTooltip.textContent = `${value}${pixelText}`;
        updateSliderBackground(popupWidthSlider, popupWidthSlider.value);
        await chrome.storage.sync.set({ popupWidth: value });
    });

    // Âª∂ËøüÈ™åËØÅÂíå‰øùÂ≠òÂºπÁ™óÂÆΩÂ∫¶
    let popupWidthTimeout;
    popupWidthInput.addEventListener('input', () => {
        clearTimeout(popupWidthTimeout);
        const value = parseInt(popupWidthInput.value, 10);
        if (!isNaN(value)) {
            if (value < 300 || value > 800) {
                popupWidthInput.classList.add('error');
            } else {
                popupWidthInput.classList.remove('error');
            }
            popupWidthTimeout = setTimeout(async () => {
                const adjustedValue = Math.max(300, Math.min(800, value));
                popupWidthInput.value = adjustedValue;
                popupWidthInput.classList.remove('error');
                popupWidthSlider.value = Math.round((adjustedValue - 300) / 31.25);
                const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
                const pixelText = currentLanguage === 'zh' ? 'ÂÉèÁ¥†' : 'px';
                popupWidthTooltip.textContent = `${adjustedValue}${pixelText}`;
                updateSliderBackground(popupWidthSlider, popupWidthSlider.value);
                await chrome.storage.sync.set({ popupWidth: adjustedValue });
            }, 1000);
        }
    });

    popupWidthInput.addEventListener('blur', async () => {
        clearTimeout(popupWidthTimeout);
        let value = parseInt(popupWidthInput.value, 10);
        if (isNaN(value) || value < 300) value = 300;
        if (value > 800) value = 800;
        popupWidthInput.value = value;
        popupWidthInput.classList.remove('error');
        popupWidthSlider.value = Math.round((value - 300) / 31.25);
        const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
        const pixelText = currentLanguage === 'zh' ? 'ÂÉèÁ¥†' : 'px';
        popupWidthTooltip.textContent = `${value}${pixelText}`;
        updateSliderBackground(popupWidthSlider, popupWidthSlider.value);
        await chrome.storage.sync.set({ popupWidth: value });
    });

    // ÁõëÂê¨Á≥ªÁªü‰∏ªÈ¢òÂèòÂåñ
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (themeSelect.value === 'system') {
            applyTheme('system');
        }
    });

    // ËØ≠Ë®ÄÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    languageSelect.addEventListener('change', async () => {
        const selectedLanguage = languageSelect.value;
        await chrome.storage.sync.set({ language: selectedLanguage });
        updateLanguageTexts(selectedLanguage);
    });

    // ÊòæÁ§∫Ê†áÁ≠æÈ°µÊï∞ÈáèÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    showTabCountCheckbox.addEventListener('change', async () => {
        await chrome.storage.sync.set({ showTabCount: showTabCountCheckbox.checked });
    });

    // ÊòæÁ§∫URLÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    if (showUrlCheckbox) {
        showUrlCheckbox.addEventListener('change', async () => {
            await chrome.storage.sync.set({ showUrl: showUrlCheckbox.checked });
        });
    }

    // Ê∏ÖÁêÜÊ®°ÂºèÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    clearModeRadios.forEach(radio => {
        radio.addEventListener('change', async () => {
            if (radio.checked) {
                await chrome.storage.sync.set({ clearMode: radio.value });
            }
        });
    });

    // ÂØºËà™‰ΩçÁΩÆÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    navigationPositionSelect.addEventListener('change', async () => {
        const selectedPosition = navigationPositionSelect.value;
        await chrome.storage.sync.set({ navigationPosition: selectedPosition });
    });

    // È°µÈù¢Ê®°ÂºèÈÄâÊã©‰∫ã‰ª∂ÁõëÂê¨
    pageModeSelect.addEventListener('change', async () => {
        const selectedMode = pageModeSelect.value;
        await chrome.storage.sync.set({ pageMode: selectedMode });
    });

    // ÁõëÂê¨Â≠òÂÇ®ÂèòÂåñ
    chrome.storage.onChanged.addListener((changes, namespace) => {
        if (namespace === 'sync' && changes.theme) {
            const newTheme = changes.theme.newValue;
            themeSelect.value = newTheme;
            applyTheme(newTheme);
        }
        if (namespace === 'sync' && changes.maxRecent) {
            const newMaxRecent = changes.maxRecent.newValue;
            maxRecentInput.value = newMaxRecent;
            maxRecentSlider.value = newMaxRecent / 1000;
        }
        if (namespace === 'sync' && changes.popupWidth) {
            const newPopupWidth = changes.popupWidth.newValue;
            popupWidthInput.value = newPopupWidth;
            popupWidthSlider.value = (newPopupWidth - 300) / 30;
        }
        if (namespace === 'sync' && changes.language) {
            const newLanguage = changes.language.newValue;
            languageSelect.value = newLanguage;
            updateLanguageTexts(newLanguage);
        }
        if (namespace === 'sync' && changes.showTabCount) {
            showTabCountCheckbox.checked = changes.showTabCount.newValue;
        }
        if (namespace === 'sync' && changes.showUrl && showUrlCheckbox) {
            showUrlCheckbox.checked = changes.showUrl.newValue;
        }
        if (namespace === 'sync' && changes.navigationPosition) {
            const newNavigationPosition = changes.navigationPosition.newValue;
            navigationPositionSelect.value = newNavigationPosition;
        }
        if (namespace === 'sync' && changes.pageMode) {
            const newPageMode = changes.pageMode.newValue;
            pageModeSelect.value = newPageMode;
        }
        if (namespace === 'sync' && changes.clearMode) {
            const newClearMode = changes.clearMode.newValue;
            clearModeRadios.forEach(radio => {
                radio.checked = radio.value === newClearMode;
            });
        }
    });

    // Ê®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥ÂÖÉÁ¥†
    const modal = document.getElementById('confirmModal');
    const clearBtn = document.getElementById('clearClosedTabsBtn');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const tabCount = document.getElementById('tabCount');

    // Êõ¥Êñ∞Ê†áÁ≠æÈ°µÊï∞ÈáèÊòæÁ§∫
    async function updateTabCountDisplay() {
        try {
            const { closedTabs = [], incognitoClosedTabs = [] } = await chrome.storage.local.get(['closedTabs', 'incognitoClosedTabs']);
            const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
            const texts = languageTexts[currentLanguage];
            const totalCount = closedTabs.length + incognitoClosedTabs.length;
            tabCount.innerHTML = `${texts.tabCountText} <strong>${totalCount}</strong> (ÊôÆÈÄö: ${closedTabs.length}, Êó†Áóï: ${incognitoClosedTabs.length})`;
        } catch (error) {
            console.error('Error updating tab count:', error);
        }
    }

    // ÊâìÂºÄÊ®°ÊÄÅÊ°Ü
    clearBtn.addEventListener('click', async () => {
        await updateTabCountDisplay();
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Èò≤Ê≠¢ËÉåÊôØÊªöÂä®
    });

    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÁöÑÂáΩÊï∞
    function closeModalFunc() {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // ÊÅ¢Â§çÊªöÂä®
    }

    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂ÁõëÂê¨
    closeModal.addEventListener('click', closeModalFunc);
    cancelBtn.addEventListener('click', closeModalFunc);

    // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModalFunc();
        }
    });

    // ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.style.display === 'block') {
            closeModalFunc();
        }
    });

    // Á°ÆËÆ§Âà†Èô§
    confirmBtn.addEventListener('click', async () => {
        try {
            // Âà†Èô§ÊâÄÊúâÂÖ≥Èó≠ÁöÑÊ†áÁ≠æÈ°µËÆ∞ÂΩïÔºàÂåÖÊã¨ÊôÆÈÄöÂíåÊó†ÁóïÔºâ
            await chrome.storage.local.set({ closedTabs: [], incognitoClosedTabs: [] });
            
            // ÈÄöÁü•ÂêéÂè∞ËÑöÊú¨Êõ¥Êñ∞ÂæΩÁ´†
            chrome.runtime.sendMessage({ type: 'updateBadge' }).catch(() => {
                // Ê∂àÊÅØÂèëÈÄÅÂ§±Ë¥•Êó∂ÁöÑÂêéÂ§áÂ§ÑÁêÜ
                console.log('Failed to send message to background script');
            });

            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            const { language: currentLanguage = 'zh' } = await chrome.storage.sync.get('language');
            const texts = languageTexts[currentLanguage];
            showSuccessMessage(texts.clearSuccess);
            // ÂàõÂª∫ÊàêÂäüÊèêÁ§∫
            showSuccessMessage(texts.deleteSuccess);
            
            closeModalFunc();
        } catch (error) {
            console.error('Error clearing closed tabs:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ');
        }
    });

    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
    function showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 1001;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease-out;
        `;
        successDiv.textContent = message;
        
        // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(successDiv);
        
        // 3ÁßíÂêéËá™Âä®ÁßªÈô§
        setTimeout(() => {
            successDiv.style.animation = 'slideInRight 0.3s ease-out reverse';
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
                if (style.parentNode) {
                    style.parentNode.removeChild(style);
                }
            }, 300);
        }, 3000);
    }

    applyTheme(savedTheme);
});

// Êõ¥Êñ∞ÊªëÂùóÂÄºÁöÑÂáΩÊï∞
function updateSliderValue(slider, value, max) {
    const percentage = (value / max) * 100;
    slider.style.setProperty('--slider-value', `${percentage}%`);
}